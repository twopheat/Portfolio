<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Compiled and minified CSS -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="assets/js/moment.js"></script>
    <script src="assets/js/script.js"></script>
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    <title>Brad.J | Portfolio</title>
  </head>
  
  <body>
    <div id="blue" class="block blue">
      <nav class="pushpin-demo-nav" data-target="blue">
        <div class="nav-wrapper light-blue">
          <div class="container">
            <a href="index.html" class="brand-logo"><img id="logopic" src="assets/images/logo.png" alt="Logo"/></a>
            <a href="#" data-target="mobile-demo" class="sidenav-trigger left"><i class="material-icons">menu</i></a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
              <li><a href="index.html">About</a></li>
              <li><a href="portfolio.html">Portfolio</a></li>
              <li><a href="planner.html">Planner</a></li>
              <li><a href="dashboard.html">Dashboard</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div>
        </div>
      </nav>
      <ul class="sidenav transparent" id="mobile-demo">
        <li><a class="btn blue lighten-2" href="index.html">About</a></li>
        <li><a class="btn blue lighten-2" href="portfolio.html">Portfolio</a></li>
        <li><a class="btn blue lighten-2" href="planner.html">Planner</a></li>
        <li><a class="btn blue lighten-2" href="dashboard.html">Weather</a></li>
        <li><a class="btn blue lighten-2" href="contact.html">Contact</a></li>
      </ul>
    </div>
    
 </header>

 <div class="container radius-2">
    
    
   
  <div class="card">
   <h1 class="text-white bg-secondary ptitle">Weather Dashboard</h1>
     <form id="form" class="card-body">
        <div class="row">
         <div class="col s12 center grey lighten-5">

           <!-- form for handling input + create text box for city search-->
           <div class="form-group">
             <input type="text" placeholder="Pick a City..." class="form-input inputs form-control" id="city-field">
             <button type="submit" class="city-search blue lighten-1 btn btn-default" id="city-search">
                 <i class="fa fa-search"></i> Search</button>
             <button class="btn btn-default yellow accent-3 black-text" id="clear-all">
                 <i class="fa fa-trash"></i> Clear</button>
           </div>
         </form>


             <div>
             </div>
         </div>

       <div class="row">

         <!-- output area for city forecasts-->
             <div id="current-weather" class="col s4"></div>
             <div id="fiveday-weather" class="col s12"></div>


       </div>

   </div>

  </div>

 </div>


 



<footer>
 <p id="copyright"><a class="yellow-text" href="https://github.com/twopheat/" >GitHub</a> | Copyright © TwoPheat | <a class="yellow-text" href="https://www.linkedin.com/in/precogit/" >LinkedIn</a></p>
</footer>

<script type="text/javascript">
 // URL is the API url and Set the API key
 var wAppId = '0bd52106274cc3890a71c0c3b0805f13',
     wURL = 'https://api.openweathermap.org/data/2.5/forecast';
 var cAppId = 'bbea62cdba22465b7f7589c50dd2081e',
     cURL = 'https://api.openweathermap.org/data/2.5/weather';
 var uAppId = 'a27e1664ed245a021cbb74c654903b2b',
     uURL = 'https://api.openweathermap.org/data/2.5/uvi';
//variables I tried to pass to global from local below(for UV), did not work 
var lati2
var long2
//--get city name and ready the data, respond if empty
var readyData = function(units) {
 var cityField = $('#city-field').val()
 
 if (cityField && cityField != ''){
   cityField = cityField.trim()
   //these calls work great
   getData1(wURL, cityField, wAppId, units)
   getData2(cURL, cityField, cAppId, units)
   //never did get this one firing below
   getData3(uURL, lati2, long2, uAppId)
   //this append applies a class to be able to re-list, but that does not work
   $('#city-list').append('<button class="btn-lg col-sm-12 bg-white re-list">' + cityField.toUpperCase() + '</button><br><br>')
 }
 else {
   alert('City field is empty!')
 }
 }
 // not sure why, but this is the doa relist function
 var relistData = function(units) {
 var reList = $('.re-list').val()
 if (reList && reList != ''){
  cityField = reList.trim()
  getData1(wURL, cityField, wAppId, units)
  getData2(cURL, cityField, cAppId, units)
  }
};
//these listeners work well
$(document).ready(function() {
 $('.city-search').click(function() {
    event.preventDefault();
    readyData('imperial');
 });
 $('#city-field').submit(function() {
    event.preventDefault();
    readyData('imperial');
 });
 $('#clear-all').click(function() {
    reset();
 });
});
//-----------------------Get and fetch 1-------------------works great, need to work onmy looping, wasn't confident
function getData1(url, cityName, appId, units) {
 var request = $.ajax({
   url:url,
   cnt:5,
   crossDomain:true,
   dataType: "jsonp",
   contentType:'text/plain',
   data: {q: cityName, appid: wAppId, units:units},
   jsonpCallback: "fetchData1",
   type:"GET"
 })
 
};

function fetchData1 (forecast) {
 var html = '',
   cityName = forecast.city.name;
   var iconLink1 = "http://openweathermap.org/img/w/" + forecast.list[1].weather[0].icon + ".png";
   var iconLink2 = "http://openweathermap.org/img/w/" + forecast.list[9].weather[0].icon + ".png";
   var iconLink3 = "http://openweathermap.org/img/w/" + forecast.list[17].weather[0].icon + ".png";
   var iconLink4 = "http://openweathermap.org/img/w/" + forecast.list[25].weather[0].icon + ".png";
   var iconLink5 = "http://openweathermap.org/img/w/" + forecast.list[33].weather[0].icon + ".png";
   html += '<h4> 5-Day Forecast for ' + forecast.city.name + '</h4><br>';
   html += '<div class="row">'
   html += '<p class="small center col s12 m2 card z-depth-1 radius-2">' + forecast.list[1].dt_txt.split(' ')[0] + '<br> <img width="50" src="'+ iconLink1 + '"> <br>Temp: ' + forecast.list[1].main.temp_max.toFixed(0) + '°<br> Humidity:' + forecast.list[1].main.humidity + '%</p>';
   html += '<p class="small center col s12 m2 card z-depth-1 radius-2">' + forecast.list[9].dt_txt.split(' ')[0] + '<br> <img width="50" src="'+ iconLink2 + '"> <br>Temp: ' + forecast.list[9].main.temp_max.toFixed(0) + '°<br> Humidity:' + forecast.list[9].main.humidity + '%</p>';
   html += '<p class="small center col s12 m2 card z-depth-1 radius-2">' + forecast.list[17].dt_txt.split(' ')[0] + '<br> <img width="50" src="'+ iconLink3 + '"> <br>Temp: ' + forecast.list[17].main.temp_max.toFixed(0) + '°<br> Humidity:' + forecast.list[17].main.humidity + '%</p>';
   html += '<p class="small center col s12 m2 card z-depth-1 radius-2">' + forecast.list[25].dt_txt.split(' ')[0] + '<br> <img width="50" src="'+ iconLink4 + '"> <br>Temp: ' + forecast.list[25].main.temp_max.toFixed(0) + '°<br> Humidity:' + forecast.list[25].main.humidity + '%</p>';
   html += '<p class="small center col s12 m2 card z-depth-1 radius-2">' + forecast.list[33].dt_txt.split(' ')[0] + '<br> <img width="50" src="'+ iconLink5 + '"> <br>Temp: ' + forecast.list[33].main.temp_max.toFixed(0) + '°<br> Humidity:' + forecast.list[33].main.humidity + '%</p>';
   html += '</div>'                
   

 $('#fiveday-weather').html(html)
};
//-----------------------Get and fetch 2-------------------this one also works, but at one point I tried to embed a function to get UV, also did not work
function getData2(url, cityName, appId, units) {
 var request1 = $.ajax({
   url:url,
   crossDomain:true,
   dataType: "jsonp",
   contentType:'text/plain',
   data: {q: cityName, appid: cAppId, units:units},
   jsonpCallback: "fetchData2",
   type:"GET"
 })
};
function fetchData2 (weather) {
 var html = '',
   cityName = weather.name;
   lati = weather.coord.lat;
   long = weather.coord.lon;
   //tried to declare lat and lon globally to use it in uv api, no luck
   window.lati2 = lati;
   window.long2 = long;
   var iconLink0 = "http://openweathermap.org/img/w/" + weather.weather[1].icon + ".png";
   
   
   console.log(weather)
   html += '<h4 class="font-weight-bold">' + cityName + ' ' + moment().format('MM-DD') + ' <img src="'+ iconLink0 + '"></h4>'
   html += '<div class="row">'
   html += '<div class="col white-text blue lighten-2 card z-depth-1 radius-2">Temp: ' + weather.main.temp.toFixed(0) + '°<br>'
   html += 'Humidity: ' + weather.main.humidity + '<br>'
   html += 'Wind Speed: ' + weather.wind.speed.toFixed(1) + ' MPH <br>'
      
 

 $('#current-weather').html(html)
 
 };
 
function getData3(url, appid, lat, lon) {
 var requestUV = $.ajax({
    url:'https://api.openweathermap.org/data/2.5/uvi',
    crossDomain:true,
    dataType: "jsonp",
    contentType:'text/plain',
    data: {lat: lati2, lon: long2, appid: 'a27e1664ed245a021cbb74c654903b2b'},
    jsonpCallback: "fetchData3",
    type:"GET"
   })
   
   function fetchData3 (uvi) {
     var html = ''
     UV = uvi.value
     html += '<p class="bg-red">UV Index: ' + UV.toFixed(2) + '</p></div>'
     html += '</div>'
     $('#current-weather').html(html)
   }
};
</script>


<footer>
  <p id="copyright"><a class="yellow-text" href="https://github.com/twopheat/" >GitHub</a> | Copyright © TwoPheat | <a class="yellow-text" href="https://www.linkedin.com/in/precogit/" >LinkedIn</a></p>
</footer>

